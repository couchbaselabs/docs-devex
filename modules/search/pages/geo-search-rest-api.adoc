= Run a Geospatial Search Query with the REST API and curl/HTTP
:page-topic-type: guide
:page-ui-name: {ui-name}
:page-product-name: {product-name}
:page-aliases: fts:fts-creating-index-from-REST-geopoint.adoc, fts:fts-creating-index-from-REST-geojson.adoc
:description: Search for geospatial data in your Couchbase {page-product-name} database with a compatible Search index, the REST API and curl/HTTP.

[abstract]
{description}

== Prerequisites

* You have the Search Service enabled on a node in your database.
For more information about how to deploy a new node and Services on your database, see xref:server:manage:manage-nodes/node-management-overview.adoc[].

* You have a bucket with scopes and collections in your database.
For more information about how to create a bucket, see xref:server:manage:manage-buckets/create-bucket.adoc[]. 

* You have documents in your database that contain geospatial data.
+
For more information about the supported data types, see xref:field-data-types-reference.adoc#geopoint[geopoint] or xref:field-data-types-reference.adoc#geoshape[geoshape].

* Your user account has the *Search Admin* role for the bucket where you want to create the Search index.
+
If you only want to run a search, you only need the *Search Reader* role. 

* You installed the Couchbase command-line tool (CLI).

* You have the hostname or IP address for the node in your database where you're running the Search Service.
For more information about where to find the IP address for your node, see xref:server:manage:manage-nodes/list-cluster-nodes.adoc[].

== Procedure

To run a geospatial Search query, <<geospatial-index,create a Search index with a geospatial type mapping>>. 

Then, <<geospatial-query,run a Search query from the Couchbase {page-ui-name}>>.  

[#geospatial-index]
=== Create a Search Index with a Geospatial Type Mapping

To create the Search index with a geospatial type mapping: 

. xref:create-search-index-rest-api.adoc[] with the following JSON payload, replacing all placeholder values that start with a `$`: 

[source,json]
----
include::example$geospatial-search-index.jsonc[]
----

[#geospatial-query]
=== Run a Geospatial Search Query

To run a Search query against the Search index: 

. In your command-line tool, enter a `curl` command with the `XPOST` verb. 
. Set your header content to include `"Content-Type: application/json"`.
. Enter your username, password, and the Search Service endpoint on port `8094` with the name of the index you want to query: 
+
[source,console]
----
include::example$run-search-header.sh[]
----
+
To use SSL, use the `https` protocol in the Search Service endpoint URL and port `18094`. 
. Enter the JSON payload for your query.  

=== Example: Geopoint Query

For example, the following query searches a geospatial field, `geo`, for any locations within a 100 mile radius of the coordinates `-2.235143, 53.482358` with a xref:search-request-params.adoc#geopoint-queries-distance[Distance/Radius-Based Geopoint Query]:

[source,console]
----
include::example$geospatial-search-query.sh[]
---- 

=== Example: GeoJSON Query 

For example, the following query searches a geospatial field, `geojson`, for any locations within a defined shape with a xref:search-request-params.adoc#geojson-queries-polygon[Polygon GeoJSON Query]:

[source,console]
----
include::example$geospatial-search-query-geojson.sh[]
---- 

== Next Steps

You can xref:customize-index.adoc[customize your Search index] to improve search results and performance.

You can also: 

* Change the JSON payload xref:search-index-params.adoc[for your Search index].
* Change the JSON payload xref:search-request-params.adoc[for your Search query].

If you want to add autocomplete to your database's search, see xref:search-query-auto-complete.adoc[].